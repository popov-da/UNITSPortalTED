/*! Cortona3D Solo Universal Viewer bundle - procedure, Copyright (c) 2015-2023 Paragraphics Ltd. (http://www.cortona3d.com/) */
define((function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=11)}({11:function(e,t,r){var n;void 0===(n=function(e,t,r){var n,o,a=Cortona3DSolo,c=a.app.procedure,i=c.interactivity,p=i&&!!i.json.$text("SimulationInteractivity/SimulationInformation/DocumentFile"),u=!1,d=null,f=null,l=c.RANGE_VALUE_CURRENT_STEP,s=0,g=a.app.util.Vec3f;if(c&&"function"!=typeof c.drawAttention){var b=c.backward,m=c.forward,h=c.seekToSubstep;c.defaultSeekMode=c.SEEK_TO_CUE_POINT,i&&a.on("app.procedure.didEnterSubstepWithName",(function(e){o=e;var t=(l=E(e))===i.getProcedureId(),r=!1,n=!1,c=d;if(c&&!t){var p=c.indexOf(l);r=p<c.length-1,n=p>0}a.dispatch("app.procedure.didEnableForward",r),a.dispatch("app.procedure.didEnableBackward",n)})),a.on("app.procedure.didChangePlayerState",(function(e,t){var r=void 0===n?16777215:t^n;n=t,s=e,1&r&&(O()?(a.dispatch("app.procedure.didPlay"),a.app.procedure.requestPlayerState()):a.dispatch("app.procedure.didStop")),1024&r&&a.dispatch("app.procedure.didPlaySound",!!(1024&t)),256&r&&a.dispatch("app.procedure.didEnableForward",!!(256&t)),512&r&&a.dispatch("app.procedure.didEnableBackward",!!(512&t)),0===e?(a.dispatch("app.procedure.onStartPosition"),1&r&&O()&&a.dispatch("app.procedure.didStart")):e>=a.app.procedure.duration&&(a.dispatch("app.procedure.onEndPosition"),1&r&&(O()||a.dispatch("app.procedure.didFinish")))})),Object.defineProperty(a.app.procedure,"locked",{get:function(){return u},set:function(e){(u=e)?v():c.setPlayRange&&c.setPlayRange(null,null,c.RANGE_FLAGS_DO_NOT_RECALCULATE_POSITION)},enumerable:!0,configurable:!0}),Object.defineProperty(a.app.procedure,"played",{get:O,enumerable:!0,configurable:!0}),Object.defineProperty(a.app.procedure,"position",{get:function(){return s},enumerable:!0,configurable:!0}),Object.defineProperty(a.app.procedure,"context",{get:function(){return[].concat(d||[])},enumerable:!0,configurable:!0}),Object.defineProperty(a.app.procedure,"state",{get:function(){return n},enumerable:!0,configurable:!0});var I={};a.expand(a.app.procedure,{toggleDrawingDisplayMode:function(e){a.dispatch("app.procedure.didDrawingDisplayMode",e),a.app.drawing.show(e),a.app.ui.showCanvas(!e)},getContextItemId:E,getActiveItemId:function(e){var t=e,r=i.getProcedureItemInfo(t),n=i.getProcedureItemInfo(x(t));if(r&&"action"===r.type&&!A(t))if(n.children&&n.children.length||n.actions.some(A)){var o=T(n.raw["@children"]||[]),a=0,c=o.indexOf(t);if(o.some(A)){do{t=o[c+(a=0===a?-1:a<0?-a:-a-1)]}while(!A(t));if("step"===(r=i.getProcedureItemInfo(t)).type){var p=function e(t){var r=[],n=i.getProcedureItemInfo(t);switch(n.type){case"action":n.comment&&(r=[t]);break;case"step":r=n.children&&n.children.length||n.actions.some(A)?T(n.raw["@children"]||[]).filter(A).reduce((function(t,r){return t.concat(e(r))}),[]):[t]}return r}(t);p.length&&(t=a>0?p[0]:p[p.length-1])}}else t=n.id}else t=n.id;return t},isValidContextItem:A,hoverObject:function(e,t,r){var n=[e],o=a.app.getHoveredObjects();n.forEach((function(e){var r=o.indexOf(e);t?r<0&&o.push(e):r>=0&&o.splice(r,1)})),a.app.setHoveredObjects(o,r)},hoverItem:function(e,t){e&&i.getObjectNamesByDocId(e).map(a.app.getObjectWithName).forEach((function(e){a.app.procedure.hoverObject(e,t,!0)}))},selectItem:function(e,t,r){if(e){var n=i.getObjectNamesByDocId(e).map(a.app.getObjectWithName),o=a.app.getSelectedObjects();n.forEach((function(e){var r=o.indexOf(e);t?r<0&&o.push(e):r>=0&&o.splice(r,1)})),a.app.setSelectedObjects(o,r)}},isItemVisible:function(e){return i.getObjectNamesByDocId(e).map(a.app.getObjectWithName).some((function(e){return 0===a.app.getObjectVisibility(e)}))},drawAttention:function(e,t){if(!(a.app.selectionMode>0)){var r=Array.isArray(e)?e:[e];return new Promise((function(e,n){var o,c=!1;function i(e){c=arguments.length?e:!c,r.forEach((function(e){e&&a.app.procedure.hoverObject(e,c,!0)}))}function p(){clearInterval(o),delete I[o],i(!1),e()}t=t||3,a.app.fitObjectsInView(r,!0,.5),o=setInterval(i,250),I[o]={finish:p,timeout:setTimeout(p,1e3*t)}}))}},drawAttentionEx:function(e,t,r){r=r||"Shape {                 geometry Sphere {}                 appearance Appearance {                     material Material {                         diffuseColor .8 .31 0                         specularColor .5 .5 .5                         emissiveColor .1 .1 .1                         ambientIntensity 0                         transparency .5                     }                 }             }";var n=Array.isArray(e)?e:[e],o=new Array(n.length);return new Promise((function(e,c){var i,p=!1,u=new Date;function d(e){p=arguments.length?e:!p,n.forEach((function(e){e&&a.app.procedure.hoverObject(e,p,!0)}))}t=t||3,a.app.fitObjectsInView(n,!0,.5),n.forEach((function(e,t){if(e){var n=a.app.getObjectBoundingBox(e);if(n){var c=new g(n.size).length()/1.8,i=a.app.createObjectsFromString("Transform { children Transform { scale "+c+" "+c+" "+c+" children "+r+" } }");i&&(a.app.addObjects(i,e),o[t]=i[0])}}})),i=setInterval(d,250);var f=setInterval((function(){var e=(new Date-u)%1e3,t=.35*(Math.cos((e-500)/500*Math.PI)+1)+.3;o.forEach((function(e){a.app.setObjectPropertyf(e,a.app.PROPERTY_SCALE,!1,t,t,t)}))}),10);function l(){clearInterval(i),clearInterval(f),delete I[i],d(!1),n.map((function(e,t){e&&a.app.removeObjects(o[t],e)})),e()}I[i]={finish:l,timeout:setTimeout(l,1e3*t)}}))},clearAllAttentions:function(){for(var e in I)clearInterval(e),clearTimeout(I[e].timeout),I[e].finish()}}),a.expand(a.app.procedure,{forward:function(e){u&&(c.stop(),c.setPlayRange());var t=d;if(t){for(var r=t.indexOf(l)+1;r<t.length&&!A(t[r]);)r++;r<t.length&&h(t[r],e)}else m(e);u&&v()},backward:function(e){u&&(c.stop(),c.setPlayRange());var t=d;if(t){for(var r=t.indexOf(l)-1;r>=0&&!A(t[r]);)r--;r>=0&&h(t[r],e)}else b(e);u&&v()},seekToSubstep:P}),i&&(a.expand(i,{getObjects:function(e){var t=[],r=Array.isArray(e)?e:[e];return(r=r.reduce((function(e,t){return e.concat(i.getDocItemInfo(t)?i.getObjectNamesByDocId(t):t)}),[])).forEach((function(e){t.indexOf(e)<0&&t.push(e)})),t.map(a.app.getObjectWithName)},getDocIdForObject:function(e){for(var t=i.getDocIdByObjectName(a.app.getObjectName(e));!t&&e;)e=a.app.getParentObject(e),t=i.getDocIdByObjectName(a.app.getObjectName(e));return t},getScreenTip:function(e){return(i.getDocItemInfo(i.getDocIdByObjectName(e))||{}).screentip||""}}),a.on("touch.didObjectEnter",(function(e,t){var r=i.getDocIdForObject(e);r&&a.dispatch("procedure.didObjectEnter",r)})),a.on("touch.didObjectOut",(function(e,t){var r=i.getDocIdForObject(e);r&&a.dispatch("procedure.didObjectOut",r)})),a.on("touch.didObjectClick",(function(e,t,r,n,o,c,p){var u=i.getDocIdForObject(e);u&&a.dispatch("procedure.didObjectClick",u,r,n,o,c,p)})),P(i.getProcedureId())),a.on("app.procedure.didChangePlayableItemList",(function(e,t){f=t}))}function O(){return!!(1&(n||0))}function v(){c.setPlayRange("object"==typeof u?u.start:l,"object"==typeof u?u.end:null,c.RANGE_FLAGS_REQUEST_NOTIFICATION|c.RANGE_FLAGS_DO_NOT_RECALCULATE_POSITION);var e=c.getPlayableRangeStartTime(),t=c.getPlayableRangeStopTime();a.dispatch("app.procedure.didChangePlayableRange",e,t)}function y(e){return!!e&&("step"===e.type&&(!e.actions.length&&e.children.map(i.getProcedureItemInfo).every(y)))}function j(e){if(i){var t,r=i.getProcedureId(),n=i.getProcedureItemInfo(e)||i.getProcedureItemInfo(r);if(n){switch(d=[],n.type){case"procedure":d=n.raw.$("Item");break;case"step":case"action":t=i.getProcedureItemInfo(n.parent),d=p?t.raw.$("Item"):t.raw["@children"]}d=T(d||[]),f&&(d=d.filter((function(e){for(var t=e;t;t=i.getProcedureItemInfo(t).parent)if(f.indexOf(e)>=0)return!0;return!1}))),d.length||(d=null)}}}function P(e,t){y(i&&i.getProcedureItemInfo(e))||(u&&(c.stop(),c.setPlayRange()),j(e),h&&(h(e,t),setTimeout((function(){a.app.procedure.requestPlayerState(),u&&v()}),0)))}function S(e){for(var t=0,r=e;r;)r=x(r),t++;return t}function E(e){var t,r,n,a=e||o,u=c.RANGE_VALUE_CURRENT_STEP;if(i)if(t=i.getProcedureItemInfo(a)||{},u=a=p&&"action"===t.type?t.parent||t.parentStep:a,d){for(n=S(d[0]);u&&d.indexOf(u)<0;)u=x(u);if(!u){for(r=d.join(""),u=a;S(u)>n;)u=x(u);j(u),d&&r!==d.join("")?(w().length||j(x(u)),u=E(a)):u=t.parentStep||i.getProcedureId()}u=function(e){var t,r=e,n=0;if(context=w(),r&&d&&context.length&&(t=d.indexOf(r))>=0)for(;context.indexOf(r)<0;)r=d[t+(n=0===n?-1:n<0?-n:-n-1)];return r}(u)}else u=t.parentStep||i.getProcedureId();return u}function w(){return d&&d.filter(A)}function A(e){var t=i.getProcedureItemInfo(e);return t&&("action"!==t.type||t.comment&&!a.uniview.options.HideActions&&!p)}function x(e){return(i.getProcedureItemInfo(e)||{}).parent}function T(e){return e.reduce((function(e,t){var r=t.$attr("id"),n=r&&i.getProcedureItemInfo(r);return n&&!y(n)?e.concat(r):e}),[])}}.call(t,r,t,e))||(e.exports=n)}})}));